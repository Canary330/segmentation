## Page 1

_
236
2024，60(21)
cD阡p“地rE门g觑PeriKg以，zd爿印，ic“加n5计算机工程与应用
面向类别不平衡的胎儿心脏超声图像分割算法
牛
2．中
亮L2，张孟璐2，陈炳华1，姜舒1，陆璐琦1，徐
晓2，牛
强：
州医科大学附属徐州市立医院徐州市第一人民医院，江苏徐州221000
国矿业大学计算机科学与技术学院，江苏徐州221000
摘要：基于深度学习的图像分割技术是处理医学图像的有力工具，胎儿心脏超声图像分割任务更是其中的热点研
冤内容。由于不同心脏部位像素点数量不平衡以及图像模糊等问题，导致现有算法对少数类像素点的分割准确度
较低，分割边界通常也不够精确。为此，提出面向类别不平衡的胎儿心脏超声图像分割算法。该算法通过嵌入代价
感知层，为少数类像素点的错误分类分配更高的损失权重，以提升少数类像素点的分类准确性。应用全局直方图均
衡化，结合空洞空间金字塔池化，获取清晰的图像轮廓和多尺度上下文信息。在真实胎儿心脏数据集上与7种先进
分割算法比较，该算法在多项评价指标上均获得了最优的分割结果。
火键词：胎儿心脏超声；图像分割；类别不平衡；代价感知；多尺度
文献标志码：A
中I刳分类号：TP391
doi：10．3778／j．issn．1002。8331．2401．0410
Fetal Echocardiogram Segmentation Algorithm for Class Imbalance
NIU Lian91一，ZHANG Menglu2，CHEN Binghual，JIANG Shul，LU Luqil，XU Xia02，NIU Qian92
1-The First People’s Hospital of Xuzhou，The Afnliated Xuzhou Municipal Hospital of Xuzhou Medical University，
Xuzhou，Jiangsu 22 1 000，China
2．School of Computer Science and TechnoIogy，China University ofMining and TechnoIogy，Xuzhou，Jiangsu 22 1 000，China
Abstract：Deep leaming_based image segmentation is
a potent t001 for medicalimage analysis，and the fetal echocardio—
gram segmentatlon
1s the士}ontier research topic．Due
to the imbalance problem in the number of pixels in dif诧rent heart
parts and the blurred image，the existing algorithms have low segmentation accuracy for minority pixels，and the segmen—
tatlon boundaries are usually inaccurate．To address these issues，this paper proposes
a fetal echocardiogram segmentation
algorithm that focuses on handling class imbalance problem．By embedding a cost—aware layer，which assigns higher loss
weights to misclassifications of minority class pixels，thereby improving the classincation accuracy of minoritV class
pixels．Additionally，the global histogram equalization combined with dilated spatial pyramid pooling obtain clear image
cOntours and multi—scale contextual information．In compa“son with
seven advanced segmentation algorithms
on
a real
fetal heart dataset，the proposed algorithm demonstrates optimal results across multiple evaluation metrics．
Key words：fetal cardiac ultrasound；image segmentatiOn：class imbalance；cost_aware：multi—scale
胎儿心脏超声图像分割是评估心脏异常和胎儿生
长的必要条件“。21，对胎儿先天性心脏病的早期检出和诊
疗计划的制定至关重要。然而，受个人经验以及图像模
糊、心脏边界不清晰等问题的影响，即使是经验丰富的
放射科医生也很难快速标出完整的异常区域，甚至做出
错误的病情诊断。因此，实现鲁棒的胎儿心脏超声图像
分割算法，对临床诊断具有重要意义。
在智能超声诊断领域，图像分割是解剖评估的关键
环节，精准的超声图像分割有助于胎儿心脏异常的早期
诊断。人工智能可以从复杂超声图像中自动分割目标
区域，使超声的使用不再局限于专业放射科医生的实
践。现有的超声图像分割方法可以分类为基于传统视
觉的分割方法和基于深度学习的分割方法”。5，。传统视
觉的图像分割方法主要有基于形状的方法和基于统计
基金项目：国家自然科学基金青年项目(62206296)；徐州市重点研发计划(Kc22142)。
作者简介：牛亮(1995一)，男，博士研究生，研究方向为医学图像处理；张孟璐(2001一)，女，硕士研究生，研究方向为医学图像处
理；陈炳华(1971)，通信作者，男，硕士生导师，主任医师，研究方向为医学图像处理，E_mail：a51800@126．com；姜舒
(1994一)，女，硕士研究生，研究方向为医学图像处理；陆璐琦(1997一)，女，硕士研究生，研究方向为医学图像处理；
徐晓(1992一)，博士，讲师，研究领域为计算机视觉；牛强(1974一)，男，博士，教授，研究领域为计算机视觉。
收稿n期：2024一01—26
修回n期：2024一05—27
文章编号：1002—833l(2024)2l一0236一08
L
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page1_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page1_img1.jpeg)

## Page 2

_
牛亮，等：面向类别不平衡的胎儿心脏超声图像分割算法
学习的方法m。7，。前者主要通过检测图像中的边缘或者
基于儿何形状的特征来实现图像的分割。后者通过学
习图像数据的统计信息来进行分割。为了缓解超声采
集过程中常见的腔壁脱落伪影干扰，Dindoyal等人m J提
出了一种基于区域信息的水平集变形模型分割心脏中
的心房和心室。通过使用可变形方法分割心脏的腔内
壁并填充缺失的结构信息，实现了血容量的计算。
siqueira等人一，利用纹理特征来区分超声图像内部的组
织边界，基于模式识别和密度概率函数，搜索对应的心
脏结构。上述基于传统视觉的图像分割方法使用手工
制作的特征来表示超声图像信息。然后，根据预定义的
规则或参数分离目标区域。此类分割方法的技术原理
相对简单，但分割精度易受预定义规则和参数的影响，
导致处理复杂结构和噪声干扰时的场景适应能力较差。
深度学习模型可以自动学习各种图像条件下的特征表
示，具有较好的鲁棒性和泛化能力u⋯。在训练数据有限
的医学图像分割场景中，基于深度神经网络实现的超声
图像分割模型可以取得与专家相近的分割结果”1。”，。
u—Net通过跳跃连接有效地融合了低级别和高级别【型像
特征信息，是医学图像分割领域最常用的分割方法u3。”，。
Rachmatullah等人”6J使用u．Net架构对胎儿心脏标准平
面进行分割，以早期发现可能的心脏结构异常。xu等
人u 7，通过堆叠u—Net准确地分割出了四腔心视图的解剖
结构，设计了负责汇聚全局和本地信息的图像分割网
络。然而，超声图像中各部位的纹理、形状和大小差异
较大，简单的u—Net l踟络往往得不到理想的分割结果。
为了提高分割进度，sengan等人n”使用预激活残差单元
构建注意网络，提出了基于注意残差的V—Net分割网络，
实现了视图识别、图像分割的全流程自动化。zeng等
人u”利用多注意机制引导网络有效捕获心跳特征，抑制
超声图像噪声，并结合深度监督机制和空问金字塔特征
融合增强特征提取能力。sfakianakis等人mo】设计了一种
基于u—Net体系结构的卷积神经I纠络集成系统，通过施
加额外的强制性解剖约束来扩展Dice损失函数优化训
练过程。为了评估胎儿心脏的泵血能力，Alam等人”||
提出了并行深度语义分割神经网络模型，用于分割胎儿
心脏左心室在收缩期和舒张期的轮廓并计算射血分
数。虽然上述方法在超声图像分割任务中取得了良好
性能，但未能充分考虑不同心脏部位像素点数量相差较
大的问题，即各个心脏部位的像素点数量是不平衡的。
这导致少数类像素的分类准确性受到限制以及像素点
类别的错分，降低了细小类别和相似类别分割的准确性
和敏感性。此外，现有的分割方法通过上／下采样方法、
大卷积核以及增加网络层数等方法在特征提取过程中
获取更大的感受野，但这导致了部分边缘细节信息和全
局上下文信息的丢失，导致分割边界不清晰。
基于上述问题，本文提出面向类别不平衡的胎儿心
脏超声图像分割算法，有效改善了胎儿心脏超声图像
分割任务中存在的类别不平衡问题并且能够获得边界
清晰和精度更高的分割掩膜。本文的主要贡献如下：
(1)以空洞空问金塔池化的方式获取多尺度图像融合信
息，通过引入并行的具有不同扩张率的空洞卷积设置来
增加卷积核的感受野，避免因下采样产生的少数类像素
信息丢失问题。(2)利用改进的代价感知损失函数，使模
型具备感知不同误分类损失的能力，加强模型对少数类
像素点分类的学习。经过多尺度信息的融合与代价感
知两个阶段的学习，类别不平衡的胎儿心脏超声图像分
割结果得到显著改善。(3)在真实胎儿心脏数据集上与7
种先进分割算法比较，在MIou、Precision、PA、Recall和
Dsc等五项评价指标上均获得了最优的结果。
1不平衡胎儿心脏超声图像分割
为了解决类不平衡问题，设计了如图l所示的不平
衡胎儿心脏超声图像分割流程，以均衡化处理后的超声
图像作为输入，在代价感知的图像分割网络中完成分割
任务。特别的，分割网络采用典型的编解码结构，以
MobileNet”21作为特征提取的骨干I列络。引入空洞空l’日J
金字塔池化模块n”，在卷积过程中获得更大的感受野和
多尺度的上下文特征。在解码阶段融合低层次和高层次
特征，经过代价感知层为误分类分配不同的损失，提出
代价感知的DeepLabv3+算法(cost aware
DeepLabv3+，
cADL3+)，实现不平衡胎儿心脏超声图像的鲁棒分割。
原始图像
均衡化结果
图1
不平衡胎儿心脏超声图像分割工作流程
Fig．1
Worknow of imbalanced
fetal echocardiogram
segmentation
1．1胎儿心脏超声图像均衡化
超声图像的采集过程易受光照条件、成像系统、信
道带宽、散斑噪声等多种因素的影响，导致图像对比度
低、动态范围有限、清晰度降低和明显的噪声等问题。
超声图像均衡化的目的是提高图像质量，使其对视觉感
知、分析和识别更有价值。
给定胎儿超声图像z，图像的灰度直方图可以定义为：
N，，
P：(g)=—号，s．t．g=o，1，⋯，L
(1)
』V
其中，N。和N分别为灰度g的个数和总的像素个数。
L
网_]
釜拦
■簟
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page2_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page2_img1.jpeg)

## Page 3

_
cD阡妒“把r Eng觑Perj心g以胛d爿印，ic以幻Ks计算机工程与应用
田鲨j茸
双线性插值
●—_____一
剪限制}限分布
I冬I 2
对比度限制自适应直方I矧均衡化
Fig．2
Contrast—limited
adaptive
histogram equalization
L是图像中的灰度级，其值一般为255。
直方图均衡化的基本思想是根据输入图像的灰度
概率分布确定相应的输出灰度值，并通过累积分布函数
扩大图像的动态范围来增强图像的对比度一4。2”。对应的
累积分布函数定义如下：
L
工(g)=∑P，(，)
(2)
J=0
为了抑制噪声的同时能增强图像的对比度，引入对
比度限制自适应直方斟均衡化(contrast limited adaptive
histogram equalization，cLAHE)”61算法对超声图像进行
预处理。图2展示了cLAHE的图像去噪流程。首先，
将原始图像切分为不同的图像块，对每个小块进行直方
图均衡化处理，以调整每个小块内的像素灰度级分布并
提高局部对比度。其次，通过截断每个图像块的累积分
布函数，防止直方图均衡化过程中的对比度过度增强。
最后，在各图像块之|、日J执行双线性插值以去除可能的伪
影，将处理过的图像块重新组合成最终的均衡化增强图
像。如图3(a)与图3(b)所示，分别代表未经均衡化处
输入
●_I_J
过剩重分配
剪限制
理和均衡化处理后的超声图像，显然经过均衡化处理的
超声图像可以在避免噪声过度增强的前提下获得更加
清晰的心脏边界。
(a)原始图像
(b)CLAHE后的图像
图3
原始图像与cLAHE算法处理后的图像对比
Fig．3
Comparison
of
original image
with image processed
by CLAHE
algorithm
1．2代价感知的图像分割网络
为了解决胎儿心脏超声图像中的类别不平衡问题
以及特征提取过程中的信息丢失问题，提出代价感知的
DeepLabv3+网络，网络架构如图4所示。在编码阶段使
图4
代价感知的DeepLabv3+网络
Fig．4
Cost aware DeepLabv3+network
L
裁J．k
串
串
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page3_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page3_img1.jpeg)

## Page 4

_
牛亮，等：面向类别不平衡的胎儿心脏超声图像分割算法
用空洞卷积和空洞空问金字塔池化提取多尺度的全局
上下文信息。在解码阶段进一步融合底层特征和高层
特征，解码器对编码器输出的特征图进行4次双线性上
采样，然后将该特征图与主干l踟中1×1卷积降维后得到
的特征图进行拼接融合。最后，通过3×3卷积向上采样
4次，经过代价感知层感知不|一J的像素错误分类，加强对
少数像素类别信息的学习，得到最终预测的语义分割图。
1．2．1
空洞卷积与空洞空问金字塔池化
在全卷积网络中，特征图上像素点的感受野范围取
决于卷积和池化操作n“。在卷积核尺寸为3，步长为1
的情况下，对不同层的特征图进行卷积，感受野的范围
会以线性增长的方式缓慢增加。图5(a)展示了对应的
连续普通卷积过程，淡紫色表示有效值，其对应的感受
野分别是3×3、5×5和7×7。空洞卷积可以在不降低空间
分辨率的情况下扩大感受野，这样可以在保留位置信息
的同时，保持语义信息的不变。空洞卷积引入了称为扩
张率的超参数来确定卷积上两个有效值之问的距离，使
得卷积核能够在不增加网络参数量的情况下获得更大
的感受野。图5(b)展示了连续的空涮卷积过程，从左到
右，依次经过普通卷积，卷积后的感受野为3×3。扩张
率为2的空洞卷积，卷积后的感受野为7×7。扩张率为
3的空洞卷积，卷积后的感受野为13×13。在卷积核和
步长相同的情况下，采用空洞卷积可以更快地获得大感
受野。但需要注意的是，连续堆叠使用多个空洞卷积会
导致“网格效应”28l，即不是每个像素点都会参与到特征
提取的过程，导致卷积得到的特征之问缺乏相关性和局
部信息丢失。为此，在编码阶段引入空洞空问金字塔池
化(atrous
spatial pyramid pooling，AsPP)模块提取并
融合多尺度特征信息。原始的AsPP模块通过叠加1个
1×1卷积、3个扩张率分别为6、12、18的3×3空洞卷积以
及平均池化层，实现多尺度的特征提取。在特征提取过
程中，随着骨干网络对图像特征的不断提取，特征图的
分辨率会不断降低，膨胀率较大的空洞卷积不利于提取
分辨率较低的特征图信息。为了解决这一问题，本文在
(a)不同感受野的常规卷积
(b)不|一J感受野的空洞卷积
图5普通卷秘和空洞卷积
Fig．5
0rdinary
conv01ution and
atrous conv01ution
AsPP中原有的空洞卷积基础上增加一层新的空洞卷
积，将扩张率分别调整为4、8、12、16，以提高对低分辨率
特征图信息的提取。设H厂表示卷积核大小为Z×，，扩
张率为r的卷积运算，AsPP的空洞卷积过程可表示为：
H(z)=H}(z)+H；(z)+Hj2(z)+Hj6(z)
(3)
1．2．2
代价感知
在解码阶段，解码器模块的主要功能是融合底层特
征和高层特征，主干网络提取的低层次特征经1×1卷积
降维后与4倍上采样后的编码器输出拼接融合，融合后
的特征依次经过3×3卷积以及4倍上采样。最后，经过
代价感知层为误分类分配不I司的损失，解决胎儿心脏超
声图像【_}l的类别不平衡问题。代价感知层的核心是代
价感知函数，它的主要作用是衡量预测值v。与期望输
出d。的最大接近度，公式定义如下：
K
c(@)=一∑d。lny。
(4)
7Fl
其中，@是网络的参数。K表示已标记的心脏部位的
种类个数，这里K的值是5。卵表示图像中的第”类心
脏部位，v，，是改进的softmax分类器的概率，表示为：
^
n
7，
v产兰
(5)
y”21■一
L3
J
yd肼e％
鬲
其中，o。是神经网络在第”个节点上的输出，‰是将
类别力错分为类别”的代价因子，其值为每一类像素点
数量的倒数m⋯。代价感知函数可以表示为：
c(@)=一妻巩1n竽
(6)
”1
yd旅e“‘
两
进一步的，分类风险可表示为：
c=一妻脚灿≠生
(7)
川
yd矾e％
：酉
接下来，计算导数并将其设为零，以找到理想输出叭
舞=舞L+舞1．
乱一矧小心∽荔
㈦
利用公式(8)求得最优输出结果：
厂K
、
()，=1n(刚z))一1nI∑P(比)睇小。
＼p21
／
r
K
K
、
lnI∑∑‰e％l
(9)
＼p=l^=l
／
L
箬黔
动
即
≠
，∑Ⅶ
=
盱
鱼眠
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page4_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page4_img1.jpeg)

## Page 5

_
cD阡妒“把r Eng觑Perj心g以胛d爿印，ic以幻Ks计算机工程与应用
这表明最优输出与第f类的贝叶斯代价之问存在
反比关系，改进后的代价感知函数是c校准的”⋯，修正
后的损失函数可以使模型对不同心脏部位更加敏感。
适用于类别不平衡的胎儿心脏超声图像分割任务。
2实验
2．1数据集与评价准则
本研究从医院妇产科收集产前超声数据，在医院相
关部门的指导下进行完全匿名化处理后进行相关研
究。在妇产科医生的指导下，最终构建来源于700名孕
妇，包含600张洲练数据和100张测试数据的私有胎
儿心脏超声数据集(fetal
heart
ultrasound
dataset
700，
FHuD700)。如图6所示，从上到下依次为原图像和标
注。该数据集共有5个类别，包括左心房、左心室、右心
房、右心室和降主动脉，分别用红色、青色、蓝色、绿色和
品红表示。很明显，心脏的5个部分是类别不平衡的，
这使得在分类过程中很容易将少数类像素误分，例如左
心房像素点很容易被误分类为左心室类别。
(c)图像1对应的标签
(d)图像2对应的标签
图6
FHuD700样例
Fig．6
FHUD700 example
本文采用了图像分割中广泛使用的5个评价标准
进行结果评估，分别是平均交并比(mean
intersection
over union，MIou)、查准率(precision)、像素精度(pixel
accuracy，PA)、召回率(recall)和Dice相似系数(Dice
similarity coe币cient，Dsc)。为方便起见，详细定义了
不同的符号。第f类像素被准确分为第f类像素的数量，
记作TP。第7类像素被准确分为第7类像素的数量，记
作TN。第z类像素被错分为第，类像素的数量，记作FN。
第i类像素被错分为第j类像素的数量，记作FP。
MIou代表每个像素类别的真实值与预测输出之问
的平均重叠百分比，定义如下：
’rD
舰u2而可赫
(10)
Precision表示某一类别的预测结果中类别预测正
确的比例，定义如下：
P阳f如io卵=而等两
(11)
PA表示像素点被正确分类的数量占总像素点数量
的比值，定义如下：
PA=面黑蒜
⋯)
Reacll表示正确分类的某一类像素点数量占此类
像素点实际数量的比值，定义如下：
R盯“，，2而专蒜
(13)
Dsc用于评估两个边界或集合之|’日J的相似性，定义
如下：
Dsc2行舌并研丙
(14)
2．2实验设置
为了公平比较，所有方法均采用FHuD700预先划
分的训练集和测试集进行实验。在训练集上采用十折
交叉验证法完成模型的超参数寻优，最终，采用2．1节所
述的评价准则，在测试集上验证模型的分割性能。超声
图像统一采用如1．1节所述的对比度限制自适应直方图
均衡化对图像进行预处理，图片尺寸统一调整为640×
640。对比方法的洲练测试过程均采用默认参数。在
cADL3+训练过程L；；}I，以MobileNet作为特征提取的骨
干网络，批大小设置为4，采用Adam作为优化器学习网
络参数@，初始学习率为o．001。共训练100个epoch，
每20个epoch将学习率降低0．5倍。公式(5)中的代价
因子‰设置为每一类像素点数量的倒数m⋯。以上所有
实验均在Ubuntu 22．04和RTx 4090上进行，软件环境
为python3．9和pytorch2．0。
2．3实验结果与分析
公平起见，在7种比较方法上分别用MIou、Precision、
PA、Recall和Dsc等5项指标对分割结果进行评估。图
7展示了不同算法在超声图像上的分割结果，表1是不
I—J方法在数据集上的评估结果。由图7的分割结果，可
以发现，cADL3+可以得到清晰的分割边界，与真实标注
吻合度较高。由图7和表1可得，本文提出的cADL3+
取得了最优的分割效果。对于DeepLabv3+及其轻量
级变体Liteseg，由于采用了空洞卷积来确保大的感受
野，在FHuD700上获得了次优结果。uNet、uNet++和
PBPuNet方法基于编码器．解码器结构，使用跳跃连接
来传输不同层次的上下文特征，但由于上采样操作导致
了图像细节信息丢失，限制了分割性能的提升。特别
的，PBPuNet采用了模糊池化缓解普通池化过程中的信
息丢失问题，与uNet和uNet++相比，PBPuNet取得了
更好的效果。对于segNet和cFPNet，虽然多尺度上下
文内容信息的应用提高了最终的分割效果，但仍然低于
L
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page5_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page5_img1.jpeg)

## Page 6

]
牛亮，等：面向类别不平衡的胎儿心脏超声图像分割算法
示例图像
真实标注
segNet
cFPNet
DeepLabv3+
cADL3+
I矧7不同方法在FHuD700数据集卜的结果对比
Fig．7
Comparison
of
dif-ferent method segmentation
results
on FHUD700 dataset
所提出的方法。在图7中观察到，7种比较方法存在明
显的像素误分类，即使是次优的DeepLabv3+，也存在左
心室(青色标注)和右心房(蓝色标注)的错分。提出的
方法则不存在明显的误分类问题且具备清晰的分割边
界，因为没计的代价感知层通过为误分类分配不同的损
失来解决类不平衡问题。同时，白适应直方图均衡化的
表l
不同分割方法的结果比较
‘rable
1
Comparison of dif’ferent segmentation
methods
单位：％
注：最优结果加粗显不。
加入有效保汪了边界轮廓的清晰。
2．3．1
消融实验
本文提出的cADL3+通过空问金字塔池化与空涮
卷积提取多尺度上下文信息，嵌入代价感知层为误分类
分配不同的损失，额外的胎儿超声图像均衡化处理为模
型训练提供优质的超声图像。为了评估图像均衡化、金
字塔池化与代价感知层的重要性，在模型训练过程中
分别加入均衡化处理、空洞卷积与空问金字塔池化、代价
感知层。以DeepLabv3+作为基准方法，将DeepLabv3+
中的空洞卷积替换为具有相同尺寸的普通卷积，记为
DeepLabv3+—_Base。DeepLabv3+一CL和DeepLabv3+—CA
则表示在基准方法上分别加入图像均衡化处理和代价感
知层。最终的分割评价结果见表2。首先，在DeepLabv3+
的基础上，使用普通卷积代替空洞卷积，按照1．2．1小节
进行配置得到DeepLabv3+Base，结果表明，各项评价
指标有不同程度的下降，这是凶为空洞卷积能够以较少
的参数获得与大卷积核相I—J大小的感受野。可以提高
模型的效率和泛化能力，避免模型过拟合问题的产生。
实验结果有效说明了重设的空洞卷积及空间金字塔池化
能够进一步充分提取超声图像特征信息。DeepLabv3+
cL的结果则说明了cLAHE的前处理对改善模型的分割
结果有一定的改善作用。其次，仅在DeepLabv3+的基
础上加入代价感知层，各项评价指标提升显著，这是因
为代价感知层旨在通过减少与少数类相关的错误来控
制总体误分类损失，而图像均衡化的过程可能会带来一
些不确定性，导致性能改善不显著。最后，本文提出的
CADL3+较基准方法DeepLabv3+，MIoU、Precision、PA、
Recall和DSC分别增加了0．92、1．62、O．63、0．88和1．19个
百分点。总的来说，消融实验结果证明了图像均衡化、
空洞空问金字塔池化和代价敏感层可以互为补充，本文
灰2消融实验
Table
2
Ablation eXperimen‘
单位：％
注：最优结果加粗显示。
L
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page6_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page6_img1.jpeg)

## Page 7

_
cD阡妒“把r Eng觑Perj心g以胛d爿印，ic以幻Ks计算机工程与应用
所提出的改进方法可提升胎儿心脏超声的分割性能，进
一步提高模型的鲁棒性。
2．3．2模型复杂度及收敛性分析
从计算量PFL㈨¨参数量P．删、模型训练时间丁I。。
和分割测试时问L。对模型的复杂度进行i平价。其中，
计算量和参数量的计算方式如下：
PFl。()h=2×Cm×K‘×C叭．1×—H×T矿×10_7
(15)
P。。l=(、。。×(K‘×C。+1)
(16)
其中，c。和c。。分别表示图像通道的输入数和输出数；
K表示卷积核的尺寸；H和w分别表示图像的高和宽。
图像的输入尺寸为640×640。通道数为3，PrL。慨和
P。。1使用torchstat工具包进行监控统计。由于Liteseg、
cFPNet和DeepLabv3+的分割性能相对较高，本文提出
的cADL3+方法仅与上述方法作比较。此外，加入2．3．1
小节中使用普通大卷积核的DeepLabv3+Base方法作
为对比，以进一步分析说明所提方法在计算量、参数量
和训练测试时|、日J上的表现。结果如表3所示。
表3模型复杂度比较
‘I'able
3
Comparison of model
complexity
从表3可以看出，在DeepLabv3+Base中因为大卷
积核和固有的多尺度特征提取分支，其对应的计算量、
参数量、模型训练时问和分割测试时问显著高于其他
所有方法。Liteseg、cFPNet方法的参数量、训练时间以
及测试时问比DeepLabv3+和cADL3+小，这是凶为
DeepLabv3+和cADL3+固有的多尺度特征提取分支增
加了网络的参数量，但因为空涮卷积的存在，使得模型
的参数量不至于过大。虽然cADL3+的训练时间较长，
但因为模型通常是离线部署的，更应该关注模型的测试
时问。cADL3+才目较于其他先进方法的测试时问是可比
的。虽然测试时I’日J有小幅度增加，但以极小的测试时|’日J
损失换取显著的如表2所示的指标改善效果是值得的。
训练过程中损失的变化趋势对于模型的收敛性至
关重要。通常，训练集和验证集上的损失函数值会随
着训练的迭代产生逐渐下降，合适的收敛应表现为损失
函数值逐渐减小并趋于稳定的状态，表明模型已收敛。
图8是cADL3+的训练损失和验证损失，可以看到在前
10个Epoch前损失下降显著，之后随着迭代的进行，损
失下降幅度较小，且伴有震荡。在约第80次迭代后，训
练损失和验汪损失趋于平缓。此时，模型呈收敛趋势。
3结束语
本文提出了面向类别不平衡的胎儿心脏超声图像
图8
CADL3+的训练损失和验证损失
Fig．8
Training
10ss
and Validation
10ss
of CADL3+
分割算法。针对胎儿心脏超声图像中存在的类别不平
衡问题，利用代价感知层为欠表示类别分配更高的损失
权重，使模型更注重少数类样本的分类。其次，通过空
洞空问金字塔池化获取图像的多尺度特征，在卷积过程
中获得更大的视野和多尺度的上下文特征。现阶段，胎
儿心脏超声图像分割仍面临有标记样本少、图像质量差
以及实时处理要求高的问题。为了应对这些挑战，未来
的前景包括使用数据增强、半监督和自监督学习、分布
式计算等技术改善图像分割结果。
参考文献：
[1]STIRNEMANN
J J，BESSON R，SPAGGIARI
E，et
a1．
DeVelopment and clinical Validation of real一time artificial
intelligence diagnostic companion for fetal ultrasound eXami—
nation[J]．ultrasound in 0bstetrics&Gynec0109y，2023，62(3)：
353—360．
[2]徐光柱，钱奕凡，王阳，等．基于两级分割的胎儿四腔心超
声切面质量评测[J]中国图象图形学报，2023，28(8)：2476—
2490．
xU G z，QIAN Y F，ⅥANG Y，et a1．Quality assessment
for fetal fou卜chamber ultrasound Views based on two—stage
segmentation[J]．Joumal of Image and Graphics，2023，28(8)：
2476—2490．
[3]SHEN Y T，CHEN L，YUE W W，et a1．Artincial intelligence
in ultrasound[J]．European Journal of Radi0109y，2021，1 39：
109717．
[4]F10RENTIN0 M C，VILLANI F E DI COSM0 M，et a1．A
review on deep—leaming algorithms for fetal ultrasound—image
analysis[J]Medical ImageAnalysis，2023，83：102629．
[5]王波，袁凤强，陈宗仁，等．多阶u—Net甲状腺超声图像自动
分割方法[J]计算机工程与应用，2023，59(5)：205—212．
WANG B，YUAN F Q，CHEN Z R，et a1．Multi—stage U—Net
automatic segmentation
of thyroid ultrasound
images[J]．
Computer Engineering and Applications，2023，59(5)：205—2 12．
[6]DINDOYAL I，LAMBROU T，DENG J，et a1．Level set snake
algo“thms
on the f色tal heart[C]／／Proceedings of
the IEEE
Intemational Symposium on Biomedical Imaging：From Nano
to Macro．2007：864—867．
[7]SIQuEIRA M L，GASPERIN C v，SCHARCANSKI J，et a1．
Echocardiographic image sequence segmentation using self_
organizing maps[c]／／Proceedings of the 2000 IEEE signal
L
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page7_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page7_img1.jpeg)

## Page 8

]
牛亮，等：面向类别不平衡的胎儿心脏超声图像分割算法
2024．60(21)
243
Processing Societv Workshop on Neural Networks fbr Signal
Processing X．2000：594—603．
『8]DINDOYAL I，LAMBROU L DENG J，et a1．Level set seg—
mentation of the fetal
heart『C]／／Proceedings of the
Interna—
tional Workshop on Functional Imaging and Modeling of the
Heart．2005：123一132．
『9]SIOUEIRA M L，NAVAUX P 0 A．Automatic heart localiza—
tion in ultrasound f色tal
images『C1／／Proceedin}王s
of the 20 1 7
IEEE
1 4th Intemational Svmposium on Biomedical Imaging
(ISBI 2017)，2007：107一112．
[1 o]王燕，南佩奇．MFFNet：多级特征融合图像语义分割网络
[J]．汁算机科学与探索，2024，18(3)：707—717．
WANG Y，NAN P Q．MFFNet：image semantic segmentation
network of multi—level feature fusionrJ]．Joumal of Frontiers
of Computer Science and Tbchn0109y，2024，1 8(3)：707—71 7．
『11]龚勋，杨菲，杜章锦，等．甲状腺、乳腺超声影像自动分析
技术综述[J]．软件学报，2020，31(7)：2245—2282．
GONG X，YANG F，DU Z J，et a1．Survey of automatic
ultrasonographic
analysis for thyroid and breast[J]Joumal
of Software，2020，3 1(7)：2245—2282．
[12]陈曦，刘奇，邓小波，等．改进u—Net的超声乳腺肿瘤分割
网络[J]．汁算机工程与应用，2022，58(22)：219—228．
CHEN X，LIU O，DENG X B，et a1．Enhanced network for
ultrasound breast tumor segmentation based
on
U—Net『J]．
computerEngineeringandApplications，2022，58(22)：219—228．
『13]RONNEBERGER 0，FISCHER P BROX T．U—net：convo一
1utional networks for biomedical image
segmentation『C]／／
Proceedings of International on Medical Image Computing
and ComDuter—Assisted Intervention．20
1 5：234—24 1．
『14]徐光宪，冯春，马飞．基于uNet的医学图像分割综述[J]
计算机科学与探索，2023，1 7(8)：1 776—1 792．
XU G X，FENG C，MA F．Review of medical image seg—
mentation based on UNet『J]．Joumal
of Frontiers of Com—
puter Science and Techn0109y’2023，17(8)：1776—1792．
[1 5]wANG R，LEI T，cuI R，et a1．Medical image segmentation
using deep leaming：a survey[J]．IET Image Processing，2022，
16r51：1243一1267．
『1 6]RACHMATULLAH M N，NURMAINI S，SAPITRI A I，et a1．
Conv01utional neural network fbr semantic segmentation
of fetal echocardiographv based
on four—chamber view『J]．
Bulletin of E1ect“cal Engineering and Infbrmatics．202 1，
10f41：1987—1996．
『17]XU L，LIU M，SHEN Z．et a1．DW—Net：a cascaded conv01u—
tional neural network for apical fou卜chamber view segmen—
tation
in
fetal echocardiography[J]．Computerized Medical
Imaging and Graphics，2020，80：101690．
『18]SENGAN S，MEHBODNIYAA，BHATIA S，et a1．Echocar_
diographic image segmentation for diagnosing
fetal cardiac
rhabdomyoma
during pregnancy
using deep
1eaming[J]．
IEEE Access．2022．10：1 14077—1 14091．
『19]ZENG Y，TSUI P H，PANG K，et a1．MAEF—Net：multi—
attention efncient f色ature f'usion network fbr left ventricular
segmentation and
quantitative
analysis in two—dimensional
echocardiography[J]U1trasonics，2023，127：106855．
『20]SR～KIANAKIS C，SIMANTIRIS G，TZIRITAS G．GUDU：
2eomet“callv—constrained ultrasound data augmentation
in
U—Net for echocardiography semantic segmen切tion[J]．Bio—
medical Signal Processing and ControL 2023，82：104557．
[21]ALAM M G R，KHAN A M，sHEJuTY M F，et a1．Ejection
fraction estimation
using deep semantic segmentation
neu—
ral network[J]The Joumal of Supercomputing，2023，79(1)：
27—50．
[22]SANDLER M，H0wARD A，zHu M，et a1．MobileNetv2：
inverted residuals and 1inear bottlenecks[C]／／Proceedings of
the IEEE Conference on ComDuter Vision and Pattern Rec—
OgnitiOn，201 8：4510—4520．
『23]CHEN L C，ZHU Y，PAPANDREOU G，et
a1．Encoder—
decoder with
atrous separable
conV01ution for semantic
image segmentation[c]／／Proceedings of the European
con—
ference on Computer vision，2018：801—818．
[24]DOUGHERTY E R．Digital image processing methods[M]．
[S．1．]：CRC Press，2020．
[25]PTzER s M，AMBuRN E P，AusTIN J D，et a1．AdaptiVe
histogram equalization and its Variations[J]Computer vision，
Graphics，and Image Processing，1987，39(3)：355—368．
[26]REzA A M．Realization of the contrast 1imited adaptiVe
his—
togram equalization(CLAHE)for real一time image enhance—
ment[J]．Journal of VLSI Signal Processing Systems for
Signal，Image and Video Tbchnology，2004，38：35—44．
[27]LONG J，SHELHAMER E，DARRELL T．Fully conV01u—
tional networks for semantic segmentation[C]／／Proceedings
of the
IEEE Conference
on ComputerⅥsion and
Pattern
RecOgnition，2叭5：343 1—3440．
[28]wANG P，CHEN P，YuAN Y，et a1．understanding conv01u—
tion for
semantic
segmentation[C]／／Proceedings of the
Winter Conference
on Applications of Computer Vision，
2018：1451—1460．
[29]HOSSAIN M S，BETTS
J M，PAPLINSKI A P Dual focal
10ss to address class imbalance in semantic segmentation[J]．
NeurocOmputing，202 1，462：69—87．
[30]KHAN
S H，HAYAT M，BENNAMOUN M，et al_Cost—
sensitive
1earning of deep
f色ature representations
ftom
imbalanced data[J]．IEEE Transactions
on Neural Networks
and Learning Systems，2017，29(8)：3573—3587．
[3 1]EMARAT，ABD EL MUNIM H E，ABBAS H M．LiteSeg：
a novel 1i曲twei曲t conVnet for semantic
segmentation[J]．
arXiv：1912．06683．2019．
[32]zHOU z，RAHMAN SIDDIQUEE M M，TAJBAKHSH N，
et a1．UNet++：a nested U—Net architecture
for medicalimage
segmentation[c]／／Proceedings
of the International work—
shop
on Deep
Learning
in Medical Image Analysis
and
Multimodal Learning for C1inical Decision
Support，20 1 8：
3—11．
[33]SHARIFzADEH M，BENALI H，RIVAz
H．InVestigating
shift
variance
of cOnv01utiOnal
neural
networks
in
ultl’a—
sound image segmentation[J]．IEEE Transactions on Ultra—
sonics，Ferroelect“cs，and Frequency contr01，2022，69(5)：
1703—1713．
[34]BADRINARAYANANv’KENDALLA，CIPOLLAR．SegNet：
a deep conv01utional encoder—decoder architectIlre fbr image
segmentation[J]．IEEE Transactions
on
Pattern Analysis
and Machine Intelligence，2017，39(12)：248l一2495．
[35]LOU A，LOEW M．CFPNet：channel一wise feature pyramid
fIor real一time semantic segmentation[c]／／Proceedings of the
IEEE
Conference
International Conference
on Image
Pro—
cessing，2021：1894—1898．
L
万方数据



### 图片

![面向类别不平衡的胎儿心脏超声图像分割算法_page8_img1.jpeg](images/面向类别不平衡的胎儿心脏超声图像分割算法_page8_img1.jpeg)
